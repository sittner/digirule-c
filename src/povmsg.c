#include "povmsg.h"
#include "buttons.h"
#include "leds.h"

#define MSG_END 0xff

static const uint8_t msg_sine[] = {
  0b00000100,
  0b00000010,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000001,
  0b00000010,
  0b00000110,
  0b00001000,
  0b00010000,
  0b00110000,
  0b00100000,
  0b00100000,
  0b00100000,
  0b00100000,
  0b00100000,
  0b00010000,
  0b00011000,
  MSG_END
};

static const uint8_t msg_text[] = {
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b00110000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00110000,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00001000,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00101001,
  0b00101001,
  0b00110011,
  0b00000000,
  0b00000000,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00100001,
  0b00111111,
  0b00011110,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00000000,
  0b00011110,
  0b00111111,
  0b00100001,
  0b00100111,
  0b00110111,
  0b00000100,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100100,
  0b00111111,
  0b00011011,
  0b00000001,
  0b00100000,
  0b00111110,
  0b00111111,
  0b00000001,
  0b00100001,
  0b00111110,
  0b00100000,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00000011,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00101001,
  0b00101001,
  0b00110011,
  0b00000000,
  0b00000000,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100100,
  0b00111111,
  0b00011011,
  0b00000001,
  0b00100000,
  0b00111110,
  0b00111111,
  0b00000001,
  0b00100001,
  0b00111110,
  0b00100000,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00100001,
  0b00000011,
  0b00000000,
  0b00100001,
  0b00111111,
  0b00111111,
  0b00101001,
  0b00101001,
  0b00110011,
  0b00000000,
  0b00011001,
  0b00111101,
  0b00101101,
  0b00101111,
  0b00100110,
  0b00000000,
  0b00111101,
  0b00111101,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0, 0b0,
  MSG_END
};

static const uint8_t msg_smile[] = {
  0b00000000,
  0b00000000,
  0b00111110,
  0b01000001,
  0b01101001,
  0b01000101,
  0b01000101,
  0b01101001,
  0b01000001,
  0b00111110,
  0b00000000,
  0b00000000,
  MSG_END
};

static const uint8_t * msg_tab[] = {
  msg_sine,
  msg_text,
  msg_smile,
  0
};

static const uint8_t **msg;
static const uint8_t *pos;

void povmsg_init(void) {
  msg = msg_tab;
  pos = *msg;
}

void povmsg_task(void) {
  if (*pos == MSG_END) {
    pos = *msg;
  }
  led_binary(LED_LOGIC_BIN, *pos);
  pos++;

  if (btn_pressed & LogicInputB) {
    msg++;
    if (*msg == 0) {
      msg = msg_tab;
    }
    pos = *msg;
  }
}

